<!DOCTYPE html>
<html>
<head>
    <title>Nested Formsets</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $(".add-formset").click(function() {
                var formset = $(this).closest(".formset");
                var newForm = formset.find(".formset-form:last").clone();
                newForm.find(":input").val("").removeAttr("checked").removeAttr("selected");
                formset.append(newForm);
            });
        });
    </script>
</head>
<body>
<form method="post" action="{% url 'home' %}">
    {% csrf_token %}

    <div class="formset">
        {{ haushaltsplan_formset.management_form }}
        {% for haushaltsplan_form in haushaltsplan_formset.forms %}
            <div class="formset-form">
                {{ haushaltsplan_form.name.label_tag }}
                {{ haushaltsplan_form.name }}

                <!-- Haushaltsposten Formset -->
                <div class="formset">
                    {{ haushaltsposten_formset.management_form }}
                    {% for haushaltsposten_form in haushaltsposten_formset.forms %}
                        <div class="formset-form">
                            {{ haushaltsposten_form.name.label_tag }}
                            {{ haushaltsposten_form.name }}

                            <!-- Projekt Formset -->
                            <div class="formset">
                                {{ projekt_formset.management_form }}
                                {% for projekt_form in projekt_formset.forms %}
                                    <div class="formset-form">
                                        {{ projekt_form.name.label_tag }}
                                        {{ projekt_form.name }}

                                        <div class="formset">
                                            {{ aufwand_formset.management_form }}
                                            {% for aufwand_form in projekt_form.aufwand_set.forms %}
                                                <div class="formset-form">
                                                    {{ aufwand_form.einnahmen.label_tag }}
                                                    {{ aufwand_form.einnahmen }}
                                                    {{ aufwand_form.ausgaben.label_tag }}
                                                    {{ aufwand_form.ausgaben }}
                                                </div>
                                            {% endfor %}
                                            <button type="button" class="add-formset">Add Aufwand</button>
                                        </div>

                                    </div>
                                    <button type="button" class="add-formset">Add Projekt</button>
                                {% endfor %}
                                <button type="button" class="add-formset">Add Posten</button>
                            </div>

                        </div>
                    {% endfor %}
                </div>

            </div>
            <button type="button" class="add-formset">Add Haushaltsplan</button>
        {% endfor %}
    </div>

    <button type="submit">Submit</button>
</form>

<script>
    $(".formset").each(function() {
        var addButton = '<button type="button" class="add-formset">Add ' + $(this).find('.formset-form:first').data('name') + '</button>';
        $(this).append(addButton);
    });
</script>
</body>
</html>
