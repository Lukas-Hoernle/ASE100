{% load static %}

<!-- HTML-Dokument beginnt hier -->
<!DOCTYPE html>
<html lang="de">

<head>
    <title>Haushaltsplan</title>

    <!-- Verwendung von Bootstrap für das Styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <!-- Verwendung von Bootstrap für JavaScript-Funktionalitäten -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
            crossorigin="anonymous"></script>

    <!-- Verwendung von Bootstrap-Icons für das Icon-Design -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body>
    <!-- Einbinden der Navbar über ein Template -->
    {% include 'navbar.html' %}

    <!-- Beginn des Hauptcontainers mit Padding -->
    <div class="container my-5">

        <!-- Formular für den Haushaltsplan -->
        <form id="haushaltsplan-form" method="post" class="form-horizontal me-3" role="form">
            <!-- CSRF-Token -->
            {% csrf_token %}

            <!-- Haushaltsplan-Formularfelder -->
            <div class="px-3">
                {% for field in haushaltsplan_form.visible_fields %}
                    <div class="form-group mb-3">
                        <label class="form-label">
                            {{ field.label }}
                        </label>

                        {{ field }}
                    </div>
                {% endfor %}
            </div>

            <!-- Formset für die Verwaltung von Haushaltsposten -->
            {{ formset.management_form }}
            {{ formset.non_form_errors }}

            <!-- Container für Haushaltsposten -->
            <div id="haushaltsposten-container">
                <div class="accordion">
                    <!-- Schleife durch alle Haushaltsposten-Formulare im Formset -->
                    {% for child_form in formset.forms %}
                        <div class="haushaltsposten-form bg-body-tertiary rounded my-4 accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="true"
                                        aria-controls="collapse{{ forloop.counter }}">
                                    Posten #{{ forloop.counter }}
                                </button>
                            </h2>
                            <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse"
                                 data-bs-parent="#accordionExample">
                                <div class="accordion-body">

                                    <!-- Schleife durch alle sichtbaren Felder des Haushaltsposten-Formulars -->
                                    {% for child_form_field in child_form.visible_fields %}
                                        <div class="form-group mb-3">
                                            <label class="form-label">
                                                {{ child_form_field.label }}
                                            </label>

                                            {{ child_form_field }}
                                        </div>
                                    {% endfor %}

                                    <!-- Überprüfung auf Nested-Formulare -->
                                    {% if child_form.nested %}
                                        <!-- Management-Formular für Nested-Formset -->
                                        {{ child_form.nested.management_form }}
                                        {{ child_form.nested.non_form_errors }}

                                        <!-- Container für Projekte -->
                                        <div class="projekt-container">
                                            <!-- Schleife durch alle Projekt-Formulare im Nested-Formset -->
                                            {% for nested_form in child_form.nested.forms %}
                                                <div class="projekt-form p-4 bg-body rounded my-4">
                                                    <!-- Schleife durch alle sichtbaren Felder des Projekt-Formulars -->
                                                    {% for nested_form_field in nested_form.visible_fields %}
                                                        <div class="form-group mb-3">
                                                            <label class="form-label">
                                                                {{ nested_form_field.label }}
                                                            </label>

                                                            {{ nested_form_field }}
                                                        </div>
                                                    {% endfor %}

                                                    <!-- Überprüfung auf weitere Nested-Formulare -->
                                                    {% if nested_form.nested %}
                                                        <!-- Management-Formular für weitere Nested-Formset -->
                                                        {{ nested_form.nested.management_form }}
                                                        {{ nested_form.nested.non_form_errors }}

                                                        <!-- Schleife durch alle sehr verschachtelten Formulare -->
                                                        {% for very_nested_form in nested_form.nested.forms %}
                                                            {% for very_nested_form_field in very_nested_form.visible_fields %}
                                                                <div class="form-group mb-3">
                                                                    <label class="form-label">
                                                                        {{ very_nested_form_field.label }}
                                                                    </label>

                                                                    {{ very_nested_form_field }}
                                                                </div>
                                                            {% endfor %}
                                                        {% endfor %}
                                                        <!-- Ende der Schleife für sehr verschachtelte Formulare -->

                                                        <!-- Löschen-Button für Projekt -->
                                                        <div class="row justify-content-end">
                                                            <div class="col-auto">
                                                                <button type="button"
                                                                        class="btn btn-outline-danger delete-projekt-btn">
                                                                    Delete Projekt
                                                                </button>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            {% endfor %}
                                            <!-- Ende der Schleife für Projekt-Formulare im Nested-Formset -->

                                            <!-- Add Projekt Button -->
                                            <div class="row justify-content-between">
                                                <div class="col-auto">
                                                    <button type="button" class="btn btn-outline-dark add-projekt-btn">
                                                        Add Projekt
                                                    </button>
                                                </div>
                                                <div class="col-auto">
                                                    <button type="button"
                                                            class="btn btn-outline-danger delete-haushaltsposten-btn">
                                                        Delete Haushaltsposten
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Ende des Containers für Projekte -->
                                    {% endif %}

                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    <!-- Ende der Schleife für Haushaltsposten-Formulare im Formset -->
                </div>
            </div>
            <!-- Ende des Containers für Haushaltsposten -->

            <!-- Add Haushaltsposten Button -->
            <div class="row justify-content-between">
                <div class="col-auto">
                    <button type="button" class="btn btn-outline-dark" id="add-haushaltsposten-btn">Add Haushaltsposten
                    </button>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-success">Submit</button>
                </div>
            </div>

        </form>

        <!-- Einbinden des JavaScripts -->
        <script defer src="{% static 'main.js' %}"></script>
    </div>
    <!-- Ende des Hauptcontainers -->

</body>

</html>
<!-- HTML-Dokument endet hier -->
